{
  "id": "guide/entity/adapter",
  "title": "Entity Adapter",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com//edit/master/NODEJS/ngrx.io/content/guide/entity/adapter.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"entity-adapter\">Entity Adapter<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/entity/adapter#entity-adapter\"><i class=\"material-icons\">link</i></a></h1>\n<h2 id=\"createentityadaptert\">createEntityAdapter&#x3C;T><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/entity/adapter#createentityadaptert\"><i class=\"material-icons\">link</i></a></h2>\n<p>A method for returning a generic entity adapter for a single entity state collection. The\nreturned adapter provides many adapter methods for performing operations\nagainst the collection type. The method takes an object with 2 properties for configuration.</p>\n<ul>\n<li><code>selectId</code>: A <code>method</code> for selecting the primary id for the collection. Optional when the entity has a primary key of <code>id</code></li>\n<li><code>sortComparer</code>: A compare function used to <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort\">sort</a> the collection. The comparer function is only needed if the collection needs to be sorted before being displayed. Set to <code>false</code> to leave the collection unsorted, which is more performant during CRUD operations.</li>\n</ul>\n<p>Usage:</p>\n<code-example header=\"user.reducer.ts\">\nimport { EntityState, EntityAdapter, createEntityAdapter } from '@ngrx/entity';\n\nexport interface User {\n  id: string;\n  name: string;\n}\n\nexport interface State extends EntityState&#x3C;User> {\n  // additional entities state properties\n  selectedUserId: number;\n}\n\nexport function selectUserId(a: User): string {\n  //In this case this would be optional since primary key is id\n  return a.id;\n}\n\nexport function sortByName(a: User, b: User): number {\n  return a.name.localeCompare(b.name);\n}\n\nexport const adapter: EntityAdapter&#x3C;User> = createEntityAdapter&#x3C;User>({\n  selectId: selectUserId,\n  sortComparer: sortByName,\n});\n</code-example>\n<h2 id=\"adapter-methods\">Adapter Methods<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/entity/adapter#adapter-methods\"><i class=\"material-icons\">link</i></a></h2>\n<p>These methods are provided by the adapter object returned\nwhen using createEntityAdapter. The methods are used inside your reducer function to manage\nthe entity collection based on your provided actions.</p>\n<h3 id=\"getinitialstate\">getInitialState<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/entity/adapter#getinitialstate\"><i class=\"material-icons\">link</i></a></h3>\n<p>Returns the <code>initialState</code> for entity state based on the provided type. Additional state is also provided through the provided configuration object. The initialState is provided to your reducer function.</p>\n<p>Usage:</p>\n<code-example header=\"user.reducer.ts\">\nimport { Action, createReducer } from '@ngrx/store';\nimport { EntityState, EntityAdapter, createEntityAdapter } from '@ngrx/entity';\n\nexport interface User {\n  id: string;\n  name: string;\n}\n\nexport interface State extends EntityState&#x3C;User> {\n  // additional entities state properties\n  selectedUserId: number | null;\n}\n\nexport const initialState: State = adapter.getInitialState({\n  // additional entity state properties\n  selectedUserId: null,\n});\n\nconst userReducer = createReducer(initialState);\n\nexport function reducer(state: State | undefined, action: Action) {\n  return userReducer(state, action);\n}\n</code-example>\n<h2 id=\"adapter-collection-methods\">Adapter Collection Methods<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/entity/adapter#adapter-collection-methods\"><i class=\"material-icons\">link</i></a></h2>\n<p>The entity adapter also provides methods for operations against an entity. These methods can change\none to many records at a time. Each method returns the newly modified state if changes were made and the same\nstate if no changes were made.</p>\n<ul>\n<li><code>addOne</code>: Add one entity to the collection</li>\n<li><code>addMany</code>: Add multiple entities to the collection</li>\n<li><code>addAll</code>: Replace current collection with provided collection</li>\n<li><code>setOne</code>: Add or Replace one entity in the collection</li>\n<li><code>removeOne</code>: Remove one entity from the collection</li>\n<li><code>removeMany</code>: Remove multiple entities from the collection, by id or by predicate</li>\n<li><code>removeAll</code>: Clear entity collection</li>\n<li><code>updateOne</code>: Update one entity in the collection. Supports partial updates.</li>\n<li><code>updateMany</code>: Update multiple entities in the collection. Supports partial updates.</li>\n<li><code>upsertOne</code>: Add or Update one entity in the collection. Supports partial updates.</li>\n<li><code>upsertMany</code>: Add or Update multiple entities in the collection. Supports partial updates.</li>\n<li><code>map</code>: Update multiple entities in the collection by defining a map function, similar to <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\">Array.map</a></li>\n</ul>\n<p>Usage:</p>\n<code-example header=\"user.model.ts\">\nexport interface User {\n  id: string;\n  name: string;\n}\n</code-example>\n<code-example header=\"user.actions.ts\">\nimport { createAction, props } from '@ngrx/store';\nimport { Update, EntityMap, Predicate } from '@ngrx/entity';\n\nimport { User } from '../models/user.model';\n\nexport const loadUsers = createAction('[User/API] Load Users', props&#x3C;{ users: User[] }>());\nexport const addUser = createAction('[User/API] Add User', props&#x3C;{ user: User }>());\nexport const setUser = createAction('[User/API] Set User', props&#x3C;{ user: User }>());\nexport const upsertUser = createAction('[User/API] Upsert User', props&#x3C;{ user: User }>());\nexport const addUsers = createAction('[User/API] Add Users', props&#x3C;{ users: User[] }>());\nexport const upsertUsers = createAction('[User/API] Upsert Users', props&#x3C;{ users: User[] }>());\nexport const updateUser = createAction('[User/API] Update User', props&#x3C;{ update: Update&#x3C;User> }>());\nexport const updateUsers = createAction('[User/API] Update Users', props&#x3C;{ updates: Update&#x3C;User>[] }>());\nexport const mapUsers = createAction('[User/API] Map Users', props&#x3C;{ entityMap: EntityMap&#x3C;User> }>());\nexport const deleteUser = createAction('[User/API] Delete User', props&#x3C;{ id: string }>());\nexport const deleteUsers = createAction('[User/API] Delete Users', props&#x3C;{ ids: string[] }>());\nexport const deleteUsersByPredicate = createAction('[User/API] Delete Users By Predicate', props&#x3C;{ predicate: Predicate&#x3C;User> }>());\nexport const clearUsers = createAction('[User/API] Clear Users');\n\n</code-example>\n<code-example header=\"user.reducer.ts\">\nimport { Action, createReducer, on } from '@ngrx/store';\nimport { EntityState, EntityAdapter, createEntityAdapter } from '@ngrx/entity';\nimport { User } from '../models/user.model';\nimport * as UserActions from '../actions/user.actions';\n\nexport interface State extends EntityState&#x3C;User> {\n  // additional entities state properties\n  selectedUserId: number | null;\n}\n\nexport const adapter: EntityAdapter&#x3C;User> = createEntityAdapter&#x3C;User>();\n\nexport const initialState: State = adapter.getInitialState({\n  // additional entity state properties\n  selectedUserId: null,\n});\n\nconst userReducer = createReducer(\n  initialState,\n  on(UserActions.addUser, (state, { user }) => {\n    return adapter.addOne(user, state)\n  }),\n  on(UserActions.setUser, (state, { user }) => {\n    return adapter.setOne(user, state)\n  }),\n  on(UserActions.upsertUser, (state, { user }) => {\n    return adapter.upsertOne(user, state);\n  }),\n  on(UserActions.addUsers, (state, { users }) => {\n    return adapter.addMany(users, state);\n  }),\n  on(UserActions.upsertUsers, (state, { users }) => {\n    return adapter.upsertMany(users, state);\n  }),\n  on(UserActions.updateUser, (state, { update }) => {\n    return adapter.updateOne(update, state);\n  }),\n  on(UserActions.updateUsers, (state, { updates }) => {\n    return adapter.updateMany(updates, state);\n  }),\n  on(UserActions.mapUsers, (state, { entityMap }) => {\n    return adapter.map(entityMap, state);\n  }),\n  on(UserActions.deleteUser, (state, { id }) => {\n    return adapter.removeOne(id, state);\n  }),\n  on(UserActions.deleteUsers, (state, { ids }) => {\n    return adapter.removeMany(ids, state);\n  }),\n  on(UserActions.deleteUsersByPredicate, (state, { predicate }) => {\n    return adapter.removeMany(predicate, state);\n  }),\n  on(UserActions.loadUsers, (state, { users }) => {\n    return adapter.addAll(users, state);\n  }),\n  on(UserActions.clearUsers, state => {\n    return adapter.removeAll({ ...state, selectedUserId: null });\n  })\n);\n\nexport function reducer(state: State | undefined, action: Action) {\n  return userReducer(state, action);\n}\n\nexport const getSelectedUserId = (state: State) => state.selectedUserId;\n\n// get the selectors\nconst {\n  selectIds,\n  selectEntities,\n  selectAll,\n  selectTotal,\n} = adapter.getSelectors();\n\n// select the array of user ids\nexport const selectUserIds = selectIds;\n\n// select the dictionary of user entities\nexport const selectUserEntities = selectEntities;\n\n// select the array of users\nexport const selectAllUsers = selectAll;\n\n// select the total user count\nexport const selectUserTotal = selectTotal;\n</code-example>\n<h3 id=\"entity-updates\">Entity Updates<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/entity/adapter#entity-updates\"><i class=\"material-icons\">link</i></a></h3>\n<p>There are a few caveats to be aware of when updating entities using the entity adapter. </p>\n<p>The first is that <code>updateOne</code> and <code>updateMany</code> make use of the <code>Update&#x3C;T></code> interface shown below. This supports partial updates.</p>\n<code-example language=\"typescript\">\ninterface UpdateStr&#x3C;T> {\n  id: string;\n  changes: Partial&#x3C;T>;\n}\n\ninterface UpdateNum&#x3C;T> {\n  id: number;\n  changes: Partial&#x3C;T>;\n}\n\ntype Update&#x3C;T> = UpdateStr&#x3C;T> | UpdateNum&#x3C;T>;\n</code-example>\n<p>Secondly, <code>upsertOne</code> and <code>upsertMany</code> will perform an insert or update. If a partial entity is provided this will perform an update.</p>\n<p>To prevent partial updates either explicitly set all the fields, setting non-used fields with value <code>undefined</code>, or use the <code>setOne</code> or <code>setAll</code> adapter methods. </p>\n<h3 id=\"entity-selectors\">Entity Selectors<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/entity/adapter#entity-selectors\"><i class=\"material-icons\">link</i></a></h3>\n<p>The <code>getSelectors</code> method returned by the created entity adapter provides functions for selecting information from the entity.</p>\n<p>The <code>getSelectors</code> method takes a selector function as its only argument to select the piece of state for a defined entity.</p>\n<p>Usage:</p>\n<code-example header=\"index.ts\">\nimport {\n  createSelector,\n  createFeatureSelector,\n  ActionReducerMap,\n} from '@ngrx/store';\nimport * as fromUser from './user.reducer';\n\nexport interface State {\n  users: fromUser.State;\n}\n\nexport const reducers: ActionReducerMap&#x3C;State> = {\n  users: fromUser.reducer,\n};\n\nexport const selectUserState = createFeatureSelector&#x3C;fromUser.State>('users');\n\nexport const selectUserIds = createSelector(\n  selectUserState,\n  fromUser.selectUserIds // shorthand for usersState => fromUser.selectUserIds(usersState)\n);\nexport const selectUserEntities = createSelector(\n  selectUserState,\n  fromUser.selectUserEntities\n);\nexport const selectAllUsers = createSelector(\n  selectUserState,\n  fromUser.selectAllUsers\n);\nexport const selectUserTotal = createSelector(\n  selectUserState,\n  fromUser.selectUserTotal\n);\nexport const selectCurrentUserId = createSelector(\n  selectUserState,\n  fromUser.getSelectedUserId\n);\n\nexport const selectCurrentUser = createSelector(\n  selectUserEntities,\n  selectCurrentUserId,\n  (userEntities, userId) => userEntities[userId]\n);\n</code-example>\n\n</div>\n\n<!-- links to this doc:\n - guide/data/entity-actions\n - guide/data/entity-reducer\n-->\n<!-- links from this doc:\n - guide/entity/adapter#adapter-collection-methods\n - guide/entity/adapter#adapter-methods\n - guide/entity/adapter#createentityadaptert\n - guide/entity/adapter#entity-adapter\n - guide/entity/adapter#entity-selectors\n - guide/entity/adapter#entity-updates\n - guide/entity/adapter#getinitialstate\n - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\n - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort\n - https://github.com//edit/master/NODEJS/ngrx.io/content/guide/entity/adapter.md?message=docs%3A%20describe%20your%20change...\n-->"
}